@page "/flashcards"
@attribute [Authorize(Policy= "IsCustomer")]
@inject HttpClient Http
@inject AuthenticationStateProvider AuthProvider

<PageTitle>Flash Cards</PageTitle>

@if (vocabs.Count > 0) 
{
    <MudStack Class="pa-3 mt-12" AlignItems="AlignItems.Center">
        <FlashCard Vocab="@vocabs[_index]"/>
    </MudStack>
} 
else 
{
    <MudProgressLinear Indeterminate=true></MudProgressLinear>
}
 

@code {
    private const string API_URL = "api/customer";
    private int _index = 0;

    private List<Vocab> vocabs = new();
    private UserFlashCardOptions _userOptions = new();

    protected override async Task OnInitializedAsync()
    {
        var user = (await AuthProvider.GetAuthenticationStateAsync()).User.Identity;

        if (user != null & user.IsAuthenticated)
        {
            _userOptions = await Http.GetFromJsonAsync<UserFlashCardOptions>(API_URL + "/get-options");
            vocabs = await Http.GetFromJsonAsync<List<Vocab>>(API_URL + $"/get-vocabs/{_userOptions.WordsPerSession}");
        }
    }
}
